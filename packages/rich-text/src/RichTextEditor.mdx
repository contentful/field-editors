---
name: Rich Text (Alpha)
route: /rich-text
menu: Editors
---

import Readme from '../README.md';

<Readme />

import { Playground } from 'docz';
import { useMemo } from 'react';
import { RichTextEditor } from './index';
import {
  createFakeFieldAPI,
  ActionsPlayground,
  createFakeSpaceAPI,
  createFakeLocalesAPI,
  createFakeNavigatorAPI,
} from '@contentful/field-editor-test-utils';
import { ValidationErrors } from '@contentful/field-editor-validation-errors';
import { documentToReactComponents } from '@contentful/rich-text-react-renderer';
import { validateRichTextDocument } from './test-utils/validation';
import { css } from 'emotion';
import publishedEntry from '../../reference/src/__fixtures__/published_entry.json';
import publishedAsset from '../../reference/src/__fixtures__/published_asset.json';

## In Action

<Playground>
  {() => {
    window.events = [];

    const rtPreviewStyle = css({
      backgroundColor: 'whitesmoke',
      padding: '0 0.5em',
      minHeight: '20px'
    });

    const newEntitySelectorDummyDialog = (fnName, type) => async () => {
      return confirm(
        `sdk.dialogs.${fnName}()\nSimulate selecting a random entity or cancel?`
      )
        ? {
            sys: {
              id: 'example-entity-id',
              type,
            },
          }
        : Promise.reject(); // Simulate cancellation.
    };

    const initialValue = JSON.parse(window.localStorage.getItem('initialValue')) || undefined
    const [field, mitt] = useMemo(() => createFakeFieldAPI(mock => mock, initialValue), []);

    const isDisabled = window.localStorage.getItem('initialDisabled') || false

    const space = useMemo(() => createFakeSpaceAPI(), []);
    const navigator = useMemo(() => createFakeNavigatorAPI(), []);
    const onAction = (...args) => window.events.push(args);

    const sdk = {
      space: {
        ...space,
        getEntry: () => {
          return Promise.resolve(publishedEntry);
        },
        getAsset: () => {
          return Promise.resolve(publishedAsset);
        },
        getEntityScheduledActions: () => {
          return Promise.resolve([]);
        },
        getAssets: () => {
          return Promise.resolve({ items: [publishedAsset] });
        },
      },
      entry: {
        ...publishedEntry,
        getSys: () => publishedEntry.sys,
      },
      field,
      locales: createFakeLocalesAPI(),
      navigator: {
        ...navigator,
        onSlideInNavigation: () => {
          return () => {};
        },
      },
      dialogs: {
        selectSingleAsset: newEntitySelectorDummyDialog(
          'selectSingleAsset',
          'Asset'
        ),
        selectSingleEntry: newEntitySelectorDummyDialog(
          'selectSingleEntry',
          'Entry'
        ),
      },
      access: {
        can: (access, entityType) => {
          if (entityType === 'Asset') {
            if (access === 'create') {
              return Promise.resolve(false);
            }
            if (access === 'read') {
              return Promise.resolve(true);
            }
          }
          return Promise.resolve(false);
        },
      },
      parameters: {
        instance: {
          getEntryUrl: () => '#',
        },
      },
      events: [],
    }

    // Validate on change
    React.useEffect(() => {
      field.onValueChanged((value) => {
        if (!value) {
          return mitt.emit('onSchemaErrorsChanged', []);
        }

        mitt.emit('onSchemaErrorsChanged', validateRichTextDocument(value));
      });
    }, [field, mitt]);

    const renderRT = (value, type) => {
      const logValue = () => {
        console.log(type, value);
      };

      const valueString = JSON.stringify(value, null, 2);

      return (
        <div className={rtPreviewStyle} title={valueString} onClick={logValue}>
          {type === 'onSchemaErrorsChanged'
            ? valueString
            : documentToReactComponents(value)}
        </div>
      );
    };

    window.richTextField = field;

    return (
      <div data-test-id="rich-text-editor-integration-test">
        <RichTextEditor
          sdk={sdk}
          onAction={onAction}
          isInitiallyDisabled={isDisabled}
        />
        <ValidationErrors field={field} locales={[]} />
        <ActionsPlayground mitt={mitt} renderValue={renderRT} />
      </div>
    );

}}

</Playground>

## As field app

```js
import { RichTextEditor, renderRichTextDialog } from '@contentful/field-editor-rich-text';

/// your app code
init((sdk) => {
  if (sdk.location.is(locations.LOCATION_DIALOG)) {
    render(renderRichTextDialog(sdk), document.getElementById('root'));
  } else if (sdk.location.is(locations.LOCATION_ENTRY_FIELD)) {
    render(
      <RichTextEditor sdk={sdk} isInitiallyDisabled={true} />,
      document.getElementById('root')
    );
  }
});
```
