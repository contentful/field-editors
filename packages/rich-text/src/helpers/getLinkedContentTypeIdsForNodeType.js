/* eslint-disable you-dont-need-lodash-underscore/find */
import flow from 'lodash/flow';
import find from 'lodash/find';
import get from 'lodash/get';

/**
 * Given a field object and a rich text node type, return a list of valid
 * content type IDs associated with the node type, based on that node type's
 * `linkContentType` validation.
 *
 * If there is no such validation or the validation is empty, return an empty
 * array.
 *
 * The navigation here is explained by the `nodes` validation having signature:
 * { nodes: { [nodeType]: validationObject[] } }
 *
 * We defensively navigate through this object because
 * 1) the field may not have a `validations` array,
 * 2) the `validations` array may be empty,
 * 3) the `validations` array may not have a `nodes` validation,
 * 4) the `nodes` validation may not validate the `nodeType`, and
 * 5) the `nodeType` validations may not have a `linkContentType` validation.
 *
 * Note that passing an empty array will result in all possible content types
 * being whitelisted.
 *
 * @param {object} field
 * @param {string} nodeType
 * @returns {string[]}
 */
export default (field, nodeType) =>
  flow(
    v => find(v, 'nodes'),
    v => get(v, ['nodes', nodeType]),
    v => find(v, 'linkContentType'),
    v => get(v, 'linkContentType', [])
  )(field.validations);
